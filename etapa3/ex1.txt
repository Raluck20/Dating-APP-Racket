(define (get-unstable-couples engagements mpref wpref)
  (let ((unstable-couples '()))
    (map (lambda (couple) (let* ((a (car couple)) (b (cdr couple)) (topman (get-pref-list wpref a)) (topwoman (get-pref-list mpref b)))
           (cond ((better-match-exists? a b topman mpref (map (lambda (x) (let* ((xd (cdr x)) (xa (car x))) (cons xd xa))) engagements))
               (cons unstable-couples (cons couple unstable-couples))
               )
           ((better-match-exists? b a topwoman wpref engagements)
               (set! unstable-couples (cons (cons a b) unstable-couples))
               ))))
         engagements)
    unstable-couples))